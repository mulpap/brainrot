<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrainRot School üß†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            color: white;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            position: relative;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* User Stats */
        .user-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin: 5px 0;
        }
        
        /* Navigation */
        .nav-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .nav-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 18px 10px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        /* Sections */
        .section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .section-title {
            font-size: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Cards */
        .cards-grid {
            display: grid;
            gap: 12px;
        }
        
        .card {
            border-radius: 15px;
            padding: 15px;
            color: #333;
            position: relative;
            overflow: hidden;
            border: 2px solid;
        }
        
        .card.common { background: linear-gradient(135deg, #E8E8E8, #F5F5F5); border-color: #B0B0B0; }
        .card.rare { background: linear-gradient(135deg, #87CEEB, #ADD8E6); border-color: #4682B4; }
        .card.epic { background: linear-gradient(135deg, #9370DB, #BA55D3); border-color: #8A2BE2; }
        .card.legendary { background: linear-gradient(135deg, #FFD700, #FFA500); border-color: #FF8C00; }
        .card.secret { background: linear-gradient(135deg, #32CD32, #00FA9A); border-color: #228B22; }
        .card.og { background: linear-gradient(135deg, #000000, #2F4F4F); border-color: #000000; color: white; }
        .card.god { background: linear-gradient(135deg, #FF0000, #DC143C); border-color: #B22222; color: white; }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }
        
        .card.common::before { background: linear-gradient(90deg, #B0B0B0, #808080); }
        .card.rare::before { background: linear-gradient(90deg, #4682B4, #1E90FF); }
        .card.epic::before { background: linear-gradient(90deg, #8A2BE2, #9400D3); }
        .card.legendary::before { background: linear-gradient(90deg, #FF8C00, #FF4500); }
        .card.secret::before { background: linear-gradient(90deg, #228B22, #32CD32); }
        .card.og::before { background: linear-gradient(90deg, #2F4F4F, #000000); }
        .card.god::before { background: linear-gradient(90deg, #B22222, #FF0000); }
        
        .card h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .card-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
        }
        
        .card.og .card-meta,
        .card.god .card-meta { color: #CCC; }
        
        /* Progress */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            border-radius: 4px;
        }
        
        /* Hidden sections */
        .hidden {
            display: none !important;
        }
        
        /* Back button */
        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            width: 100%;
            justify-content: center;
            position: sticky;
            top: 10px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Class selection */
        .class-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-top: 15px;
        }
        
        .class-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 10px 5px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            color: #333;
            transition: all 0.3s ease;
        }
        
        .class-btn.current {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
        }
        
        .class-btn:hover {
            transform: translateY(-2px);
        }
        
        /* Registration */
        .user-type-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .user-type-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 20px 15px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            color: #333;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .user-type-btn:hover {
            transform: translateY(-3px);
        }
        
        /* Quiz */
        .quiz-question {
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.4;
        }
        
        .quiz-options {
            display: grid;
            gap: 10px;
        }
        
        .quiz-option {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            color: #333;
            transition: all 0.3s ease;
            text-align: left;
        }
        
        .quiz-option:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
        }
        
        .start-quiz-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 25px 20px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            color: #333;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
        }
        
        .start-quiz-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 18px;
        }
        
        .profile-info {
            line-height: 2;
            margin-bottom: 20px;
        }
        
        .rarity-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .common-badge { background: #B0B0B0; color: white; }
        .rare-badge { background: #4682B4; color: white; }
        .epic-badge { background: #8A2BE2; color: white; }
        .legendary-badge { background: #FF8C00; color: white; }
        .secret-badge { background: #32CD32; color: white; }
        .og-badge { background: #000000; color: white; }
        .god-badge { background: #FF0000; color: white; }

        /* Form styles */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 16px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .continue-btn, .save-btn, .buy-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: none;
            padding: 15px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            color: white;
            width: 100%;
            margin-top: 10px;
        }

        .donate-btn {
            background: linear-gradient(135deg, #FF416C, #FF4B2B);
            border: none;
            padding: 15px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            color: white;
            width: 100%;
            margin-top: 10px;
        }
        
        .continue-btn:hover, .save-btn:hover, .buy-btn:hover, .donate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* Class info */
        .class-info {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 15px;
            margin: 15px 0;
            text-align: center;
        }

        /* Edit button */
        .edit-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }

        .edit-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Loading for schools */
        .schools-loading {
            text-align: center;
            padding: 10px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Lootbox styles */
        .lootbox-grid {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .lootbox-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            border: 3px solid;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .lootbox-card.common { 
            border-color: #B0B0B0; 
            background: linear-gradient(135deg, rgba(176, 176, 176, 0.2), rgba(128, 128, 128, 0.1));
        }
        .lootbox-card.epic { 
            border-color: #8A2BE2; 
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(148, 0, 211, 0.1));
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
        }
        .lootbox-card.legendary { 
            border-color: #FF8C00; 
            background: linear-gradient(135deg, rgba(255, 140, 0, 0.2), rgba(255, 69, 0, 0.1));
            box-shadow: 0 0 25px rgba(255, 140, 0, 0.4);
            animation: glowLegendary 2s ease-in-out infinite alternate;
        }
        .lootbox-card.secret { 
            border-color: #32CD32; 
            background: linear-gradient(135deg, rgba(50, 205, 50, 0.2), rgba(34, 139, 34, 0.1));
            box-shadow: 0 0 30px rgba(50, 205, 50, 0.5);
            animation: glowSecret 1.5s ease-in-out infinite alternate;
        }

        @keyframes glowLegendary {
            from { box-shadow: 0 0 25px rgba(255, 140, 0, 0.4); }
            to { box-shadow: 0 0 35px rgba(255, 140, 0, 0.7); }
        }

        @keyframes glowSecret {
            from { box-shadow: 0 0 30px rgba(50, 205, 50, 0.5); }
            to { box-shadow: 0 0 45px rgba(50, 205, 50, 0.8); }
        }

        .lootbox-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .lootbox-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        .lootbox-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .lootbox-price {
            font-size: 20px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: bold;
        }

        .lootbox-chances {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 15px;
            line-height: 1.4;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 10px;
        }

        .coins-icon {
            color: #FFD700;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }

        .money-icon {
            color: #32CD32;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(50, 205, 50, 0.5);
        }

        /* Lootbox opening animation */
        .lootbox-opening {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .chest-container {
            position: relative;
            margin-bottom: 30px;
        }

        .chest {
            font-size: 120px;
            animation: bounce 0.5s ease infinite alternate;
        }

        .chest.common { color: #B0B0B0; }
        .chest.epic { color: #8A2BE2; text-shadow: 0 0 20px #8A2BE2; }
        .chest.legendary { color: #FF8C00; text-shadow: 0 0 25px #FF8C00; animation: bounceGlow 0.5s ease infinite alternate; }
        .chest.secret { color: #32CD32; text-shadow: 0 0 30px #32CD32; animation: bounceGlowFast 0.4s ease infinite alternate; }

        @keyframes bounce {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        @keyframes bounceGlow {
            from { transform: scale(1); text-shadow: 0 0 25px #FF8C00; }
            to { transform: scale(1.15); text-shadow: 0 0 35px #FF8C00; }
        }

        @keyframes bounceGlowFast {
            from { transform: scale(1); text-shadow: 0 0 30px #32CD32; }
            to { transform: scale(1.2); text-shadow: 0 0 45px #32CD32; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .opening-text {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
            animation: pulse 1.5s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .revealed-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            border: 3px solid;
            max-width: 300px;
            animation: cardReveal 0.5s ease;
        }

        @keyframes cardReveal {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .revealed-card h3 {
            font-size: 24px;
            margin-bottom: 10px;
            color: white;
        }

        .revealed-rarity {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .close-animation {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            color: white;
            margin-top: 20px;
        }

        .close-animation:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Registration Screen -->
        <div id="registrationScreen" class="hidden">
            <div class="header">
                <h1>üß† BrainRot School</h1>
                <p>–í—ã–±–µ—Ä–∏ —Å–≤–æ–π —Å—Ç–∞—Ç—É—Å:</p>
            </div>
            
            <div class="user-type-buttons">
                <button class="user-type-btn" onclick="showSchoolForm()">
                    <span>üéí</span>
                    <span>–£—á–µ–Ω–∏–∫</span>
                    <small>1-11 –∫–ª–∞—Å—Å</small>
                </button>
                <button class="user-type-btn" onclick="registerUser('adult')">
                    <span>üë®‚Äçüéì</span>
                    <span>–í–∑—Ä–æ—Å–ª—ã–π</span>
                    <small>–°—Ç—É–¥–µ–Ω—Ç/–í—ã–ø—É—Å–∫–Ω–∏–∫</small>
                </button>
            </div>
            
            <div class="section">
                <div class="section-title">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
                <p style="font-size: 14px; line-height: 1.4;">
                    ‚Ä¢ –£—á–µ–Ω–∏–∫–∏: –∫–ª–∞—Å—Å—ã 1-11 —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –ø–æ —à–∫–æ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ<br>
                    ‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–µ: –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –æ–±—â—É—é —ç—Ä—É–¥–∏—Ü–∏—é –∏ –ª–æ–≥–∏–∫—É<br>
                    ‚Ä¢ –°–æ–±–∏—Ä–∞–π –∫–∞—Ä—Ç–æ—á–∫–∏ —Å BrainRot –º–µ–º–∞–º–∏!
                </p>
            </div>
        </div>

        <!-- School Registration Form -->
        <div id="schoolFormScreen" class="hidden">
            <button class="back-btn" onclick="showRegistration()">‚Üê –ù–∞–∑–∞–¥</button>
            
            <div class="header">
                <h1>üéí –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—á–µ–Ω–∏–∫–∞</h1>
                <p>–ó–∞–ø–æ–ª–Ω–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —à–∫–æ–ª–µ</p>
            </div>
            
            <div class="section">
                <div class="form-group">
                    <label class="form-label">üèôÔ∏è –ì–æ—Ä–æ–¥/–ù–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</label>
                    <select class="form-select" id="citySelect" onchange="loadSchools()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">üè´ –®–∫–æ–ª–∞</label>
                    <select class="form-select" id="schoolSelect" disabled>
                        <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">üìö –ö–ª–∞—Å—Å</label>
                        <select class="form-select" id="classSelect">
                            <option value="1">1 –∫–ª–∞—Å—Å</option>
                            <option value="2">2 –∫–ª–∞—Å—Å</option>
                            <option value="3">3 –∫–ª–∞—Å—Å</option>
                            <option value="4">4 –∫–ª–∞—Å—Å</option>
                            <option value="5">5 –∫–ª–∞—Å—Å</option>
                            <option value="6">6 –∫–ª–∞—Å—Å</option>
                            <option value="7">7 –∫–ª–∞—Å—Å</option>
                            <option value="8">8 –∫–ª–∞—Å—Å</option>
                            <option value="9">9 –∫–ª–∞—Å—Å</option>
                            <option value="10">10 –∫–ª–∞—Å—Å</option>
                            <option value="11">11 –∫–ª–∞—Å—Å</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üî§ –ë—É–∫–≤–∞ –∫–ª–∞—Å—Å–∞</label>
                        <select class="form-select" id="classLetterSelect">
                            <option value="–ê">–ê</option>
                            <option value="–ë">–ë</option>
                            <option value="–í">–í</option>
                            <option value="–ì">–ì</option>
                            <option value="–î">–î</option>
                            <option value="–ï">–ï</option>
                            <option value="–Å">–Å</option>
                            <option value="–ñ">–ñ</option>
                            <option value="–ó">–ó</option>
                            <option value="–ò">–ò</option>
                            <option value="–ö">–ö</option>
                            <option value="–õ">–õ</option>
                            <option value="–ú">–ú</option>
                            <option value="–ù">–ù</option>
                            <option value="–û">–û</option>
                            <option value="–ü">–ü</option>
                            <option value="–†">–†</option>
                            <option value="–°">–°</option>
                            <option value="–¢">–¢</option>
                            <option value="–£">–£</option>
                            <option value="–§">–§</option>
                            <option value="–•">–•</option>
                            <option value="–≠">–≠</option>
                            <option value="–Æ">–Æ</option>
                            <option value="–Ø">–Ø</option>
                        </select>
                    </div>
                </div>
                
                <div class="class-info">
                    <div>üèÜ –¢–≤–æ–π –∫–ª–∞—Å—Å:</div>
                    <div id="classPreview" style="font-size: 18px; font-weight: bold; margin: 5px 0;">-</div>
                    <div style="font-size: 12px; opacity: 0.8;">–í—Å–µ –æ–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ!</div>
                </div>
                
                <button class="continue-btn" onclick="completeStudentRegistration()">
                    üöÄ –ù–∞—á–∞—Ç—å —É—á–∏—Ç—å—Å—è!
                </button>
            </div>
        </div>
        
        <!-- Main Screen -->
        <div id="mainScreen" class="hidden">
            <div class="header">
                <h1>üß† BrainRot School</h1>
                <p id="userGreeting">–°–æ–±–∏—Ä–∞–π –º–µ–º—ã, —Å—Ç–∞–Ω—å –ª–µ–≥–µ–Ω–¥–æ–π!</p>
            </div>
            
            <div class="user-stats">
                <div class="stat-card">
                    <div>üéí –ö–ª–∞—Å—Å</div>
                    <div class="stat-value" id="currentClass">-</div>
                    <div id="userTypeInfo">—É—á–µ–Ω–∏–∫</div>
                </div>
                <div class="stat-card">
                    <div>üí∞ –ú–æ–Ω–µ—Ç—ã</div>
                    <div class="stat-value" id="coinsCount">100</div>
                    <div id="dailyCoins">+0 —Å–µ–≥–æ–¥–Ω—è</div>
                </div>
            </div>
            
            <div class="nav-grid">
                <button class="nav-btn" onclick="showSection('quiz')">
                    <span>üéì</span>
                    <span>–ö–≤–∏–∑</span>
                </button>
                <button class="nav-btn" onclick="showSection('shop')">
                    <span>üõçÔ∏è</span>
                    <span>–ú–∞–≥–∞–∑–∏–Ω</span>
                </button>
                <button class="nav-btn" onclick="showSection('inventory')">
                    <span>üé¥</span>
                    <span>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</span>
                </button>
                <button class="nav-btn" onclick="showSection('collection')">
                    <span>üìö</span>
                    <span>–ö–æ–ª–ª–µ–∫—Ü–∏—è</span>
                </button>
                <button class="nav-btn" onclick="showSection('profile')">
                    <span>üë§</span>
                    <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
                </button>
            </div>
            
            <div class="section">
                <div class="section-title">üë• –ú–æ–π –∫–ª–∞—Å—Å</div>
                <div style="text-align: center; margin-bottom: 10px;">
                    <strong id="fullClassInfo">-</strong>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="collectionProgress"></div>
                </div>
                <div style="text-align: center; font-size: 14px; color: rgba(255,255,255,0.8);">
                    <span id="collectedCards">0</span> –∏–∑ <span id="totalCards">0</span> –∫–∞—Ä—Ç–æ—á–µ–∫ —Å–æ–±—Ä–∞–Ω–æ
                </div>
            </div>
        </div>
        
        <!-- Quiz Section -->
        <div id="quizSection" class="hidden">
            <button class="back-btn" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é</button>
            <div class="section">
                <div class="section-title">üéì –ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ—é —ç—Ä—É–¥–∏—Ü–∏—é</div>
                <button class="start-quiz-btn" onclick="startQuiz()">
                    <span>üöÄ</span>
                    <span>–ù–∞—á–∞—Ç—å –∫–≤–∏–∑</span>
                    <small>5 –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã</small>
                </button>
            </div>
        </div>
        
        <!-- Quiz Questions Section -->
        <div id="quizQuestionsSection" class="hidden">
            <button class="back-btn" onclick="showSection('quiz')">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="section">
                <div class="section-title">üìù –í–æ–ø—Ä–æ—Å <span id="currentQuestionNumber">1</span>/5</div>
                <div class="quiz-question" id="quizQuestion">
                    –í–æ–ø—Ä–æ—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...
                </div>
                <div class="quiz-options" id="quizOptions">
                    <!-- Options will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Shop Section -->
        <div id="shopSection" class="hidden">
            <button class="back-btn" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é</button>
            <div class="section">
                <div class="section-title">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω –ª—É—Ç–±–æ–∫—Å–æ–≤</div>
                <div class="lootbox-grid">
                    <!-- Common Lootbox -->
                    <div class="lootbox-card common">
                        <span class="lootbox-icon">üì¶</span>
                        <div class="lootbox-title">–û–±—ã—á–Ω—ã–π –ª—É—Ç–±–æ–∫—Å</div>
                        <div>–®–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å:</div>
                        <div class="lootbox-chances">
                            ‚Ä¢ –û–±—ã—á–Ω—ã–µ: 70%<br>
                            ‚Ä¢ –†–∞—Ä–Ω—ã–µ: 25%<br>
                            ‚Ä¢ –≠–ø–∏–∫: 5%
                        </div>
                        <div class="lootbox-price">
                            <span class="coins-icon">üí∞</span> 100 –º–æ–Ω–µ—Ç
                        </div>
                        <button class="buy-btn" onclick="confirmPurchase('common')">
                            –ö—É–ø–∏—Ç—å –∑–∞ –º–æ–Ω–µ—Ç—ã
                        </button>
                    </div>

                    <!-- Epic Lootbox -->
                    <div class="lootbox-card epic">
                        <span class="lootbox-icon">üíé</span>
                        <div class="lootbox-title">–≠–ø–∏–∫ –ª—É—Ç–±–æ–∫—Å</div>
                        <div>–®–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å:</div>
                        <div class="lootbox-chances">
                            ‚Ä¢ –†–∞—Ä–Ω—ã–µ: 50%<br>
                            ‚Ä¢ –≠–ø–∏–∫: 40%<br>
                            ‚Ä¢ –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ: 10%
                        </div>
                        <div class="lootbox-price">
                            <span class="coins-icon">üí∞</span> 500 –º–æ–Ω–µ—Ç
                        </div>
                        <button class="buy-btn" onclick="confirmPurchase('epic')">
                            –ö—É–ø–∏—Ç—å –∑–∞ –º–æ–Ω–µ—Ç—ã
                        </button>
                    </div>

                    <!-- Legendary Lootbox -->
                    <div class="lootbox-card legendary">
                        <span class="lootbox-icon">üåü</span>
                        <div class="lootbox-title">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ª—É—Ç–±–æ–∫—Å</div>
                        <div>–®–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å:</div>
                        <div class="lootbox-chances">
                            ‚Ä¢ –≠–ø–∏–∫: 40%<br>
                            ‚Ä¢ –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ: 35%<br>
                            ‚Ä¢ –°–µ–∫—Ä–µ—Ç–Ω—ã–µ: 20%<br>
                            ‚Ä¢ OG: 5%
                        </div>
                        <div class="lootbox-price">
                            <span class="money-icon">üí≥</span> 199 ‚ÇΩ
                        </div>
                        <button class="donate-btn" onclick="confirmPurchase('legendary')">
                            –ö—É–ø–∏—Ç—å –∑–∞ –¥–æ–Ω–∞—Ç
                        </button>
                    </div>

                    <!-- Secret Lootbox -->
                    <div class="lootbox-card secret">
                        <span class="lootbox-icon">üîÆ</span>
                        <div class="lootbox-title">–°–µ–∫—Ä–µ—Ç–Ω—ã–π –ª—É—Ç–±–æ–∫—Å</div>
                        <div>–®–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å:</div>
                        <div class="lootbox-chances">
                            ‚Ä¢ –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ: 40%<br>
                            ‚Ä¢ –°–µ–∫—Ä–µ—Ç–Ω—ã–µ: 30%<br>
                            ‚Ä¢ OG: 20%<br>
                            ‚Ä¢ –ë–æ–≥ BrainRot: 10%
                        </div>
                        <div class="lootbox-price">
                            <span class="money-icon">üí≥</span> 499 ‚ÇΩ
                        </div>
                        <button class="donate-btn" onclick="confirmPurchase('secret')">
                            –ö—É–ø–∏—Ç—å –∑–∞ –¥–æ–Ω–∞—Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Inventory Section -->
        <div id="inventorySection" class="hidden">
            <button class="back-btn" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é</button>
            <div class="section">
                <div class="section-title">üé¥ –¢–≤–æ–∏ –∫–∞—Ä—Ç—ã</div>
                <div class="cards-grid" id="inventoryList">
                    <!-- Cards will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Collection Section -->
        <div id="collectionSection" class="hidden">
            <button class="back-btn" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é</button>
            <div class="section">
                <div class="section-title">üìö –í—Å—è –∫–æ–ª–ª–µ–∫—Ü–∏—è</div>
                <div class="cards-grid" id="collectionList">
                    <!-- All cards will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Profile Section -->
        <div id="profileSection" class="hidden">
            <button class="back-btn" onclick="showMain()">‚Üê –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é</button>
            <div class="section">
                <div class="section-title">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div>
                <div id="profileContent">
                    <!-- Profile info will be loaded here -->
                </div>
                
                <div class="section-title" style="margin-top: 20px;">
                    üè´ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —à–∫–æ–ª–µ
                    <button class="edit-btn" onclick="showEditSchoolForm()">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
                </div>
                <div id="schoolInfo">
                    <!-- School info will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Edit School Form -->
        <div id="editSchoolForm" class="hidden">
            <button class="back-btn" onclick="showSection('profile')">‚Üê –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ—Ñ–∏–ª—é</button>
            
            <div class="header">
                <h1>‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å —à–∫–æ–ª—É</h1>
                <p>–û–±–Ω–æ–≤–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —à–∫–æ–ª–µ</p>
            </div>
            
            <div class="section">
                <div class="form-group">
                    <label class="form-label">üèôÔ∏è –ì–æ—Ä–æ–¥/–ù–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</label>
                    <select class="form-select" id="editCitySelect" onchange="loadEditSchools()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">üè´ –®–∫–æ–ª–∞</label>
                    <select class="form-select" id="editSchoolSelect" disabled>
                        <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">üìö –ö–ª–∞—Å—Å</label>
                        <select class="form-select" id="editClassSelect">
                            <option value="1">1 –∫–ª–∞—Å—Å</option>
                            <option value="2">2 –∫–ª–∞—Å—Å</option>
                            <option value="3">3 –∫–ª–∞—Å—Å</option>
                            <option value="4">4 –∫–ª–∞—Å—Å</option>
                            <option value="5">5 –∫–ª–∞—Å—Å</option>
                            <option value="6">6 –∫–ª–∞—Å—Å</option>
                            <option value="7">7 –∫–ª–∞—Å—Å</option>
                            <option value="8">8 –∫–ª–∞—Å—Å</option>
                            <option value="9">9 –∫–ª–∞—Å—Å</option>
                            <option value="10">10 –∫–ª–∞—Å—Å</option>
                            <option value="11">11 –∫–ª–∞—Å—Å</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üî§ –ë—É–∫–≤–∞ –∫–ª–∞—Å—Å–∞</label>
                        <select class="form-select" id="editClassLetterSelect">
                            <option value="–ê">–ê</option>
                            <option value="–ë">–ë</option>
                            <option value="–í">–í</option>
                            <option value="–ì">–ì</option>
                            <option value="–î">–î</option>
                            <option value="–ï">–ï</option>
                            <option value="–Å">–Å</option>
                            <option value="–ñ">–ñ</option>
                            <option value="–ó">–ó</option>
                            <option value="–ò">–ò</option>
                            <option value="–ö">–ö</option>
                            <option value="–õ">–õ</option>
                            <option value="–ú">–ú</option>
                            <option value="–ù">–ù</option>
                            <option value="–û">–û</option>
                            <option value="–ü">–ü</option>
                            <option value="–†">–†</option>
                            <option value="–°">–°</option>
                            <option value="–¢">–¢</option>
                            <option value="–£">–£</option>
                            <option value="–§">–§</option>
                            <option value="–•">–•</option>
                            <option value="–≠">–≠</option>
                            <option value="–Æ">–Æ</option>
                            <option value="–Ø">–Ø</option>
                        </select>
                    </div>
                </div>
                
                <div class="class-info">
                    <div>üèÜ –ù–æ–≤—ã–π –∫–ª–∞—Å—Å:</div>
                    <div id="editClassPreview" style="font-size: 18px; font-weight: bold; margin: 5px 0;">-</div>
                </div>
                
                <button class="save-btn" onclick="saveSchoolChanges()">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
            </div>
        </div>

        <!-- Lootbox Opening Animation -->
        <div id="lootboxAnimation" class="lootbox-opening hidden">
            <div class="chest-container">
                <div class="chest" id="animatedChest">üéÅ</div>
            </div>
            <div class="opening-text" id="openingText">–û—Ç–∫—Ä—ã–≤–∞–µ–º –ª—É—Ç–±–æ–∫—Å...</div>
            <div id="revealedCard" class="hidden">
                <div class="revealed-card" id="cardContent">
                    <h3 id="cardName"></h3>
                    <div class="revealed-rarity" id="cardRarity"></div>
                    <div>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º –∫–∞—Ä—Ç—ã!</div>
                </div>
            </div>
            <button class="close-animation" onclick="closeAnimation()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        
        <!-- Loading Screen -->
        <div id="loadingScreen" class="hidden">
            <div class="loading">
                <div>üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
    </div>

    <script>
        // Game data
        let gameData = {
            userType: '', // 'student' or 'adult'
            currentClass: 1,
            classLetter: '–ê',
            city: '',
            school: '',
            coins: 100, // Start with 100 coins
            xp: 0,
            cards: [],
            profile: {
                display_name: "–ò–≥—Ä–æ–∫",
                total_quizzes: 0,
                correct_answers: 0,
                rating: 1000
            }
        };

        // All BrainRot cards with updated rarity order and added 67 character
        const ALL_CARDS = [
            // –û–±—ã—á–Ω—ã–µ
            { name: "–ü–∏–ø–∏ –∫–∏–≤–∏", rarity: "common", obtained: false },
            { name: "–ê–≥–∞—Ä–∏–Ω–∏ –ª–∞ –ø–∞–ª–∏–Ω–∏", rarity: "common", obtained: false },
            { name: "–ë—Ä –±—Ä –ø–∞—Ç–∞–ø–∏–º", rarity: "common", obtained: false },
            
            // –†–∞—Ä–Ω—ã–µ
            { name: "–¢—Ä–∏–ø–∏ —Ç—Ä–æ–ø–∞", rarity: "rare", obtained: false },
            { name: "–ß—É—Ö–∞–Ω–∏–Ω–∏ —Ç–∞–∫–æ–Ω–∏–Ω–∏", rarity: "rare", obtained: false },
            { name: "–ì–∞—Ç–∞—Ç–∏—Ç–æ –Ω—è—É–Ω–∏—Ç–æ", rarity: "rare", obtained: false },
            
            // –≠–ø–∏–∫
            { name: "–ì–∞—Ä–∞–º–∞ –∏ –º–∞–¥—É–Ω–≥", rarity: "epic", obtained: false },
            { name: "–ö–∞—Ä–∫–µ–∫–∞—Ä –∫—É—Ä–∫—É—Ä", rarity: "epic", obtained: false },
            { name: "–¢–∞ —Ç–∞ —Ç–∞ —Å–∞—Ö—É—Ä", rarity: "epic", obtained: false },
            { name: "–¢–æ —Ç–æ —Ç–æ —Å–∞—Ö—É—Ä", rarity: "epic", obtained: false },
            { name: "–õ–∞ –∫–∞–∫—Ä–∫–µ—Ä–∫–∞—Ä –∫–æ–º–±–∏–Ω–∞—Å–∏–æ–Ω", rarity: "epic", obtained: false },
            { name: "–õ–∞ —Å–ø—É–∫–∏ –≥—Ä–∞–Ω–¥–µ", rarity: "epic", obtained: false },
            { name: "–î–∂–æ–± –¥–∂–æ–± —Å–∞—Ö—É—Ä", rarity: "epic", obtained: false },
            { name: "–õ–æ—Å –±–æ–º–±–∏–Ω–∏—Ç–æ—Å", rarity: "epic", obtained: false },
            
            // –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ
            { name: "–õ–æ—Å –¥–∂–æ–±—Å–∏—Ç–æ—Å", rarity: "legendary", obtained: false },
            { name: "–¢—É–Ω–≥ —Å–∞—Ö—É—Ä", rarity: "legendary", obtained: false },
            { name: "–°–∫–∞–ª —Å–∫–∞–ª —Å–∫–∞–ª", rarity: "legendary", obtained: false },
            { name: "–ë—Ä–∞–∑–∏–ª–∏–Ω–∏ –±—ç—Ä–∏–º–±–∏–Ω–∏", rarity: "legendary", obtained: false },
            { name: "–î—É–ª –¥—É–ª –¥—É–ª", rarity: "legendary", obtained: false },
            
            // –°–µ–∫—Ä–µ—Ç–Ω—ã–µ
            { name: "–õ–∞ —Å–µ–∫—Ä–µ—Ç –∫–æ–º–±–∏–Ω–∞—Å–∏–æ–Ω", rarity: "secret", obtained: false },
            { name: "–°–ø–∞–≥–µ—Ç—Ç–∏ —Ç—É–∞–ª–µ—Ç–∏", rarity: "secret", obtained: false },
            { name: "–î—Ä–∞–≥–æ–Ω –∫–∞–Ω–µ–ª–æ–Ω–∏", rarity: "secret", obtained: false },
            { name: "–õ–∞ —ç—Å–æ–∫ —Å—ç–∫–æ–ª–∞", rarity: "secret", obtained: false },
            { name: "–ü–æ—Ç —Ö–æ—Å–ø–æ—Ç", rarity: "secret", obtained: false },
            { name: "–®–ø–∏–æ–Ω–∏—Ä–æ –≥–æ–ª—É–±–∏—Ä–æ", rarity: "secret", obtained: false },
            { name: "–¢—É—Ä—Ç—É–≥–∏–Ω–∏ –¥—Ä–∞–≥–æ–Ω —Ñ—Ä—É—Ç–∏–Ω–∏", rarity: "secret", obtained: false },
            
            // OG
            { name: "–°—Ç—Ä–æ–≤–±—ç—Ä–∏ —ç–ª–∏—Ñ—ç–Ω—Ç", rarity: "og", obtained: false },
            { name: "–ú–∏—è–≤–ª", rarity: "og", obtained: false },
            
            // God BrainRot - HIGHEST RARITY
            { name: "–¢—Ä–∏–ø–∞ —Ç—Ä–æ–ø–∞", rarity: "god", obtained: false },
            { name: "–õ–∞ –≥—Ä–∞–Ω–¥–µ –∫–æ–º–±–∏–Ω–∞—Å–∏–æ–Ω", rarity: "god", obtained: false },
            { name: "67", rarity: "god", obtained: false }
        ];

        // Lootbox configurations
        const LOOTBOXES = {
            common: {
                price: 100,
                currency: 'coins',
                chances: {
                    common: 70,
                    rare: 25,
                    epic: 5
                }
            },
            epic: {
                price: 500,
                currency: 'coins',
                chances: {
                    rare: 50,
                    epic: 40,
                    legendary: 10
                }
            },
            legendary: {
                price: 199,
                currency: 'money',
                chances: {
                    epic: 40,
                    legendary: 35,
                    secret: 20,
                    og: 5
                }
            },
            secret: {
                price: 499,
                currency: 'money',
                chances: {
                    legendary: 40,
                    secret: 30,
                    og: 20,
                    god: 10
                }
            }
        };

        // Quiz questions for general knowledge
        const GENERAL_KNOWLEDGE_QUESTIONS = [
            // –ù–∞—É–∫–∞
            {q: "–ö–∞–∫–∞—è –ø–ª–∞–Ω–µ—Ç–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞ –∫–∞–∫ '–ö—Ä–∞—Å–Ω–∞—è –ø–ª–∞–Ω–µ—Ç–∞'?", opts: ["–í–µ–Ω–µ—Ä–∞", "–ú–∞—Ä—Å", "–Æ–ø–∏—Ç–µ—Ä", "–°–∞—Ç—É—Ä–Ω"], a: 1},
            {q: "–°–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π —Ç–∞–±–ª–∏—Ü–µ?", opts: ["118", "92", "150", "108"], a: 0},
            {q: "–ß—Ç–æ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è –≤ –≥–µ—Ä—Ü–∞—Ö?", opts: ["–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ", "–ß–∞—Å—Ç–æ—Ç–∞", "–°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ", "–ú–æ—â–Ω–æ—Å—Ç—å"], a: 1},
            {q: "–ö–∞–∫–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º—ã–º –±–æ–ª—å—à–∏–º –Ω–∞ –ó–µ–º–ª–µ?", opts: ["–°–ª–æ–Ω", "–°–∏–Ω–∏–π –∫–∏—Ç", "–ñ–∏—Ä–∞—Ñ", "–ë–µ–ª–∞—è –∞–∫—É–ª–∞"], a: 1},
            
            // –ì–µ–æ–≥—Ä–∞—Ñ–∏—è
            {q: "–ö–∞–∫–∞—è —Å–∞–º–∞—è –¥–ª–∏–Ω–Ω–∞—è —Ä–µ–∫–∞ –≤ –º–∏—Ä–µ?", opts: ["–ê–º–∞–∑–æ–Ω–∫–∞", "–ù–∏–ª", "–Ø–Ω—Ü–∑—ã", "–ú–∏—Å—Å–∏—Å–∏–ø–∏"], a: 0},
            {q: "–í –∫–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–∏—Ä–∞–º–∏–¥–∞ –•–µ–æ–ø—Å–∞?", opts: ["–ì—Ä–µ—Ü–∏—è", "–ï–≥–∏–ø–µ—Ç", "–ú–µ–∫—Å–∏–∫–∞", "–ò—Ç–∞–ª–∏—è"], a: 1},
            {q: "–ö–∞–∫–∞—è —Å—Ç–æ–ª–∏—Ü–∞ –ê–≤—Å—Ç—Ä–∞–ª–∏–∏?", opts: ["–°–∏–¥–Ω–µ–π", "–ú–µ–ª—å–±—É—Ä–Ω", "–ö–∞–Ω–±–µ—Ä—Ä–∞", "–ë—Ä–∏—Å–±–µ–Ω"], a: 2},
            
            // –ò—Å—Ç–æ—Ä–∏—è
            {q: "–í –∫–∞–∫–æ–º –≥–æ–¥—É –Ω–∞—á–∞–ª–∞—Å—å –í—Ç–æ—Ä–∞—è –º–∏—Ä–æ–≤–∞—è –≤–æ–π–Ω–∞?", opts: ["1939", "1941", "1945", "1935"], a: 0},
            {q: "–ö—Ç–æ –±—ã–ª –ø–µ—Ä–≤—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º –≤ –∫–æ—Å–º–æ—Å–µ?", opts: ["–ù–∏–ª –ê—Ä–º—Å—Ç—Ä–æ–Ω–≥", "–Æ—Ä–∏–π –ì–∞–≥–∞—Ä–∏–Ω", "–ê–ª–∞–Ω –®–µ–ø–∞—Ä–¥", "–í–∞–ª–µ–Ω—Ç–∏–Ω–∞ –¢–µ—Ä–µ—à–∫–æ–≤–∞"], a: 1},
            
            // –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞
            {q: "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–í–æ–π–Ω—É –∏ –º–∏—Ä'?", opts: ["–î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π", "–¢–æ–ª—Å—Ç–æ–π", "–ß–µ—Ö–æ–≤", "–¢—É—Ä–≥–µ–Ω–µ–≤"], a: 1},
            {q: "–ö–∞–∫ –∑–≤–∞–ª–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è '–ï–≤–≥–µ–Ω–∏—è –û–Ω–µ–≥–∏–Ω–∞'?", opts: ["–í–ª–∞–¥–∏–º–∏—Ä", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä", "–ï–≤–≥–µ–Ω–∏–π", "–ü–µ—Ç—Ä"], a: 2},
            
            // –û–±—â–∏–µ –∑–Ω–∞–Ω–∏—è
            {q: "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ—Ä–æ–Ω —É —à–µ—Å—Ç–∏—É–≥–æ–ª—å–Ω–∏–∫–∞?", opts: ["5", "6", "7", "8"], a: 1},
            {q: "–ö–∞–∫–æ–µ —Ö–∏–º–∏—á–µ—Å–∫–æ–µ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ —É –∑–æ–ª–æ—Ç–∞?", opts: ["Go", "Gd", "Au", "Ag"], a: 2},
            {q: "–ö—Ç–æ –Ω–∞—Ä–∏—Å–æ–≤–∞–ª '–ú–æ–Ω—É –õ–∏–∑—É'?", opts: ["–í–∞–Ω –ì–æ–≥", "–ü–∏–∫–∞—Å—Å–æ", "–õ–µ–æ–Ω–∞—Ä–¥–æ –¥–∞ –í–∏–Ω—á–∏", "–ú–∏–∫–µ–ª–∞–Ω–¥–∂–µ–ª–æ"], a: 2},
            {q: "–ö–∞–∫–æ–π –æ–∫–µ–∞–Ω —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π?", opts: ["–ê—Ç–ª–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π", "–ò–Ω–¥–∏–π—Å–∫–∏–π", "–¢–∏—Ö–∏–π", "–°–µ–≤–µ—Ä–Ω—ã–π –õ–µ–¥–æ–≤–∏—Ç—ã–π"], a: 2},
            
            // –õ–æ–≥–∏–∫–∞
            {q: "–ü—Ä–æ–¥–æ–ª–∂–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 2, 4, 8, 16...", opts: ["24", "32", "20", "18"], a: 1},
            {q: "–ï—Å–ª–∏ –≤—Å–µ –≤–æ—Ä–æ–Ω—ã —á–µ—Ä–Ω—ã–µ, –∞ —ç—Ç–∞ –ø—Ç–∏—Ü–∞ –Ω–µ —á–µ—Ä–Ω–∞—è, —Ç–æ –æ–Ω–∞...", opts: ["–Ω–µ –≤–æ—Ä–æ–Ω", "–≤–æ—Ä–æ–Ω", "—Å–æ–≤–∞", "–≥–æ–ª—É–±—å"], a: 0},
            
            // –ö—É–ª—å—Ç—É—Ä–∞
            {q: "–í –∫–∞–∫–æ–º –≥–æ—Ä–æ–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å—Ç–∞—Ç—É—è –•—Ä–∏—Å—Ç–∞-–ò—Å–∫—É–ø–∏—Ç–µ–ª—è?", opts: ["–ë—É—ç–Ω–æ—Å-–ê–π—Ä–µ—Å", "–†–∏–æ-–¥–µ-–ñ–∞–Ω–µ–π—Ä–æ", "–õ–∏–º–∞", "–°–∞–Ω—Ç—å—è–≥–æ"], a: 1},
            {q: "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª –º—É–∑—ã–∫—É –∫ '–õ–µ–±–µ–¥–∏–Ω–æ–º—É –æ–∑–µ—Ä—É'?", opts: ["–ß–∞–π–∫–æ–≤—Å–∫–∏–π", "–ë–∞—Ö", "–ú–æ—Ü–∞—Ä—Ç", "–ë–µ—Ç—Ö–æ–≤–µ–Ω"], a: 0}
        ];

        let currentQuiz = {
            questions: [],
            currentQuestion: 0,
            correctAnswers: 0
        };

        // Database of Russian cities and schools (including Yuzhno-Sakhalinsk)
        const RUSSIAN_CITIES = [
            "–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥",
            "–ö–∞–∑–∞–Ω—å", "–ß–µ–ª—è–±–∏–Ω—Å–∫", "–û–º—Å–∫", "–°–∞–º–∞—Ä–∞", "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É", "–£—Ñ–∞", "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫",
            "–í–æ—Ä–æ–Ω–µ–∂", "–ü–µ—Ä–º—å", "–í–æ–ª–≥–æ–≥—Ä–∞–¥", "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "–°–∞—Ä–∞—Ç–æ–≤", "–¢—é–º–µ–Ω—å", "–¢–æ–ª—å—è—Ç—Ç–∏",
            "–ò–∂–µ–≤—Å–∫", "–ë–∞—Ä–Ω–∞—É–ª", "–£–ª—å—è–Ω–æ–≤—Å–∫", "–ò—Ä–∫—É—Ç—Å–∫", "–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫", "–Ø—Ä–æ—Å–ª–∞–≤–ª—å", "–•–∞–±–∞—Ä–æ–≤—Å–∫",
            "–ú–∞—Ö–∞—á–∫–∞–ª–∞", "–û—Ä–µ–Ω–±—É—Ä–≥", "–¢–æ–º—Å–∫", "–ù–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫", "–ö–µ–º–µ—Ä–æ–≤–æ", "–ê—Å—Ç—Ä–∞—Ö–∞–Ω—å", "–†—è–∑–∞–Ω—å",
            "–ü–µ–Ω–∑–∞", "–ù–∞–±–µ—Ä–µ–∂–Ω—ã–µ –ß–µ–ª–Ω—ã", "–õ–∏–ø–µ—Ü–∫", "–¢—É–ª–∞", "–ö–∏—Ä–æ–≤", "–ß–µ–±–æ–∫—Å–∞—Ä—ã", "–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥",
            "–ö—É—Ä—Å–∫", "–£–ª–∞–Ω-–£–¥—ç", "–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å", "–°–æ—á–∏", "–¢–≤–µ—Ä—å", "–ú–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫", "–ò–≤–∞–Ω–æ–≤–æ",
            "–ë—Ä—è–Ω—Å–∫", "–ë–µ–ª–≥–æ—Ä–æ–¥", "–°—É—Ä–≥—É—Ç", "–Æ–∂–Ω–æ-–°–∞—Ö–∞–ª–∏–Ω—Å–∫"
        ];

        // Function to generate schools for a city
        function generateSchoolsForCity(city) {
            const schools = [];
            
            // Generate schools including Gimnaziya 3 for Yuzhno-Sakhalinsk
            const schoolCount = 10 + Math.floor(Math.random() * 6);
            
            for (let i = 1; i <= schoolCount; i++) {
                const types = ["–°–û–®", "–ì–∏–º–Ω–∞–∑–∏—è", "–õ–∏—Ü–µ–π"];
                const type = types[Math.floor(Math.random() * types.length)];
                
                let schoolName;
                if (type === "–°–û–®") {
                    schoolName = `–°—Ä–µ–¥–Ω—è—è –æ–±—â–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —à–∫–æ–ª–∞ ‚Ññ${i}`;
                } else if (type === "–ì–∏–º–Ω–∞–∑–∏—è") {
                    schoolName = `–ì–∏–º–Ω–∞–∑–∏—è ‚Ññ${i}`;
                } else {
                    schoolName = `–õ–∏—Ü–µ–π ‚Ññ${i}`;
                }
                
                schools.push(schoolName);
            }
            
            // Add some special schools
            schools.push(`–§–∏–∑–∏–∫–æ-–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ª–∏—Ü–µ–π ${city}`);
            schools.push(`–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è –≥–∏–º–Ω–∞–∑–∏—è ${city}`);
            schools.push(`–®–∫–æ–ª–∞ —Å —É–≥–ª—É–±–ª–µ–Ω–Ω—ã–º –∏–∑—É—á–µ–Ω–∏–µ–º –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö —è–∑—ã–∫–æ–≤ ${city}`);
            
            return schools;
        }

        // City-schools database
        const SCHOOLS_DATABASE = {};
        RUSSIAN_CITIES.forEach(city => {
            SCHOOLS_DATABASE[city] = generateSchoolsForCity(city);
        });

        // Function to completely hide lootbox animation
        function hideLootboxAnimation() {
            const animation = document.getElementById('lootboxAnimation');
            animation.classList.add('hidden');
            
            // Reset animation state
            document.getElementById('revealedCard').classList.add('hidden');
            document.getElementById('openingText').textContent = '–û—Ç–∫—Ä—ã–≤–∞–µ–º –ª—É—Ç–±–æ–∫—Å...';
        }

        // Initialize the game
        function initGame() {
            // –í–ê–ñ–ù–û: –°–Ω–∞—á–∞–ª–∞ —Å–∫—Ä—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ª—É—Ç–±–æ–∫—Å–∞
            hideLootboxAnimation();
            
            // Check if user is already registered
            const savedData = localStorage.getItem('brainrotGameData');
            if (savedData) {
                gameData = JSON.parse(savedData);
                showMain();
            } else {
                showRegistration();
            }
            
            // Load cities into selects
            loadCities();
            
            updateUI();
            
            // Setup class preview
            setupClassPreview();
            setupEditClassPreview();
            
            // Telegram Web App integration
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.expand();
                Telegram.WebApp.ready();
                Telegram.WebApp.setHeaderColor('#667eea');
                Telegram.WebApp.setBackgroundColor('#667eea');
            }
        }

        // Load cities into select elements
        function loadCities() {
            const citySelect = document.getElementById('citySelect');
            const editCitySelect = document.getElementById('editCitySelect');
            
            RUSSIAN_CITIES.sort().forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                citySelect.appendChild(option);
                
                const editOption = document.createElement('option');
                editOption.value = city;
                editOption.textContent = city;
                editCitySelect.appendChild(editOption);
            });
        }

        // Load schools for selected city
        function loadSchools() {
            const citySelect = document.getElementById('citySelect');
            const schoolSelect = document.getElementById('schoolSelect');
            const selectedCity = citySelect.value;
            
            schoolSelect.innerHTML = '<option value="">–ó–∞–≥—Ä—É–∑–∫–∞ —à–∫–æ–ª...</option>';
            schoolSelect.disabled = true;
            
            // Simulate loading delay
            setTimeout(() => {
                if (selectedCity && SCHOOLS_DATABASE[selectedCity]) {
                    schoolSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —à–∫–æ–ª—É</option>';
                    SCHOOLS_DATABASE[selectedCity].sort().forEach(school => {
                        const option = document.createElement('option');
                        option.value = school;
                        option.textContent = school;
                        schoolSelect.appendChild(option);
                    });
                    schoolSelect.disabled = false;
                } else {
                    schoolSelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>';
                    schoolSelect.disabled = true;
                }
                updateClassPreview();
            }, 500);
        }

        // Load schools for edit form
        function loadEditSchools() {
            const citySelect = document.getElementById('editCitySelect');
            const schoolSelect = document.getElementById('editSchoolSelect');
            const selectedCity = citySelect.value;
            
            schoolSelect.innerHTML = '<option value="">–ó–∞–≥—Ä—É–∑–∫–∞ —à–∫–æ–ª...</option>';
            schoolSelect.disabled = true;
            
            // Simulate loading delay
            setTimeout(() => {
                if (selectedCity && SCHOOLS_DATABASE[selectedCity]) {
                    schoolSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —à–∫–æ–ª—É</option>';
                    SCHOOLS_DATABASE[selectedCity].sort().forEach(school => {
                        const option = document.createElement('option');
                        option.value = school;
                        option.textContent = school;
                        schoolSelect.appendChild(option);
                    });
                    schoolSelect.disabled = false;
                    
                    // If editing existing data, try to select current school
                    if (gameData.school && SCHOOLS_DATABASE[selectedCity].includes(gameData.school)) {
                        schoolSelect.value = gameData.school;
                    }
                } else {
                    schoolSelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>';
                    schoolSelect.disabled = true;
                }
                updateEditClassPreview();
            }, 500);
        }

        // Setup class preview in registration form
        function setupClassPreview() {
            const classSelect = document.getElementById('classSelect');
            const letterSelect = document.getElementById('classLetterSelect');
            const citySelect = document.getElementById('citySelect');
            const schoolSelect = document.getElementById('schoolSelect');
            
            const updatePreview = () => {
                updateClassPreview();
            };
            
            classSelect.addEventListener('change', updatePreview);
            letterSelect.addEventListener('change', updatePreview);
            citySelect.addEventListener('change', updatePreview);
            schoolSelect.addEventListener('change', updatePreview);
            
            updatePreview();
        }

        function updateClassPreview() {
            const classNum = document.getElementById('classSelect').value;
            const letter = document.getElementById('classLetterSelect').value;
            const city = document.getElementById('citySelect').value || '–ì–æ—Ä–æ–¥';
            const school = document.getElementById('schoolSelect').value || '–®–∫–æ–ª–∞';
            
            document.getElementById('classPreview').textContent = 
                `${classNum}${letter} –∫–ª–∞—Å—Å, ${school}, ${city}`;
        }

        // Setup class preview in edit form
        function setupEditClassPreview() {
            const classSelect = document.getElementById('editClassSelect');
            const letterSelect = document.getElementById('editClassLetterSelect');
            const citySelect = document.getElementById('editCitySelect');
            const schoolSelect = document.getElementById('editSchoolSelect');
            
            const updatePreview = () => {
                updateEditClassPreview();
            };
            
            classSelect.addEventListener('change', updatePreview);
            letterSelect.addEventListener('change', updatePreview);
            citySelect.addEventListener('change', updatePreview);
            schoolSelect.addEventListener('change', updatePreview);
        }

        function updateEditClassPreview() {
            const classNum = document.getElementById('editClassSelect').value;
            const letter = document.getElementById('editClassLetterSelect').value;
            const city = document.getElementById('editCitySelect').value || '–ì–æ—Ä–æ–¥';
            const school = document.getElementById('editSchoolSelect').value || '–®–∫–æ–ª–∞';
            
            document.getElementById('editClassPreview').textContent = 
                `${classNum}${letter} –∫–ª–∞—Å—Å, ${school}, ${city}`;
        }

        // Save game data to localStorage
        function saveGameData() {
            localStorage.setItem('brainrotGameData', JSON.stringify(gameData));
        }

        // Show registration screen
        function showRegistration() {
            hideAllScreens();
            document.getElementById('registrationScreen').classList.remove('hidden');
        }

        // Show school form
        function showSchoolForm() {
            hideAllScreens();
            document.getElementById('schoolFormScreen').classList.remove('hidden');
        }

        // Show edit school form
        function showEditSchoolForm() {
            // Fill form with current data
            document.getElementById('editCitySelect').value = gameData.city;
            document.getElementById('editClassSelect').value = gameData.currentClass;
            document.getElementById('editClassLetterSelect').value = gameData.classLetter;
            
            // Load schools for current city
            loadEditSchools();
            
            hideAllScreens();
            document.getElementById('editSchoolForm').classList.remove('hidden');
        }

        // Register user
        function registerUser(userType) {
            gameData.userType = userType;
            if (userType === 'student') {
                // Student registration will be completed in completeStudentRegistration
                return;
            } else {
                gameData.currentClass = 12; // Special value for adults
                gameData.coins = 100;
                saveGameData();
                showMain();
                updateUI();
                alert(`üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ BrainRot School!`);
            }
        }

        // Complete student registration
        function completeStudentRegistration() {
            const city = document.getElementById('citySelect').value;
            const school = document.getElementById('schoolSelect').value;
            const classNum = parseInt(document.getElementById('classSelect').value);
            const classLetter = document.getElementById('classLetterSelect').value;
            
            if (!city || !school) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            
            gameData.userType = 'student';
            gameData.city = city;
            gameData.school = school;
            gameData.currentClass = classNum;
            gameData.classLetter = classLetter;
            gameData.coins = 100;
            
            saveGameData();
            showMain();
            updateUI();
            
            alert(`üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ ${classNum}${classLetter} –∫–ª–∞—Å—Å!\nüè´ ${school}, ${city}`);
        }

        // Save school changes
        function saveSchoolChanges() {
            const city = document.getElementById('editCitySelect').value;
            const school = document.getElementById('editSchoolSelect').value;
            const classNum = parseInt(document.getElementById('editClassSelect').value);
            const classLetter = document.getElementById('editClassLetterSelect').value;
            
            if (!city || !school) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            
            gameData.city = city;
            gameData.school = school;
            gameData.currentClass = classNum;
            gameData.classLetter = classLetter;
            
            saveGameData();
            showSection('profile');
            updateUI();
            
            alert(`‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —à–∫–æ–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!\nüè´ ${classNum}${classLetter} –∫–ª–∞—Å—Å, ${school}, ${city}`);
        }

        // Confirm purchase function
        function confirmPurchase(type) {
            const lootbox = LOOTBOXES[type];
            const currencyText = lootbox.currency === 'coins' ? '–º–æ–Ω–µ—Ç—ã' : '—Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏';
            const priceText = lootbox.currency === 'coins' ? `${lootbox.price} –º–æ–Ω–µ—Ç` : `${lootbox.price}‚ÇΩ`;
            
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å ${type} –ª—É—Ç–±–æ–∫—Å –∑–∞ ${priceText}?`)) {
                buyLootbox(type);
            }
        }

        // Buy lootbox function
        function buyLootbox(type) {
            const lootbox = LOOTBOXES[type];
            
            if (lootbox.currency === 'coins') {
                if (gameData.coins < lootbox.price) {
                    alert(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç! –ù—É–∂–Ω–æ: ${lootbox.price}üí∞`);
                    return;
                }
                gameData.coins -= lootbox.price;
            } else {
                // For real money purchases - simulate payment
                alert(`üí≥ –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –õ—É—Ç–±–æ–∫—Å –ø–æ–ª—É—á–µ–Ω –±–µ—Å–ø–ª–∞—Ç–Ω–æ!`);
            }
            
            // Show opening animation
            showLootboxAnimation(type);
        }

        // Show lootbox opening animation
        function showLootboxAnimation(type) {
            const animation = document.getElementById('lootboxAnimation');
            const chest = document.getElementById('animatedChest');
            const openingText = document.getElementById('openingText');
            const revealedCard = document.getElementById('revealedCard');
            
            // Set chest style based on type
            chest.className = 'chest ' + type;
            
            // Reset animation state
            revealedCard.classList.add('hidden');
            openingText.textContent = '–û—Ç–∫—Ä—ã–≤–∞–µ–º –ª—É—Ç–±–æ–∫—Å...';
            
            // Show animation
            animation.classList.remove('hidden');
            
            // Open lootbox after delay
            setTimeout(() => {
                const card = openLootbox(type);
                openingText.textContent = 'üéâ –í—ã –ø–æ–ª—É—á–∏–ª–∏ –∫–∞—Ä—Ç—É!';
                revealCard(card);
                
                // Save game data
                saveGameData();
                updateUI();
            }, 2000);
        }

        // Reveal card in animation
        function revealCard(card) {
            const revealedCard = document.getElementById('revealedCard');
            const cardName = document.getElementById('cardName');
            const cardRarity = document.getElementById('cardRarity');
            const cardContent = document.getElementById('cardContent');
            
            cardName.textContent = card.name;
            cardRarity.textContent = getRarityName(card.rarity);
            cardContent.className = `revealed-card ${card.rarity}`;
            
            revealedCard.classList.remove('hidden');
        }

        // Close animation
        function closeAnimation() {
            hideLootboxAnimation();
            showMain();
        }

        // Open lootbox and get random card
        function openLootbox(type) {
            const lootbox = LOOTBOXES[type];
            const random = Math.random() * 100;
            let selectedRarity = '';
            let cumulative = 0;
            
            // Determine rarity based on chances
            for (const [rarity, chance] of Object.entries(lootbox.chances)) {
                cumulative += chance;
                if (random <= cumulative) {
                    selectedRarity = rarity;
                    break;
                }
            }
            
            // Get available cards of selected rarity
            const availableCards = ALL_CARDS.filter(card => 
                card.rarity === selectedRarity && !card.obtained
            );
            
            let selectedCard;
            
            if (availableCards.length > 0) {
                // Get random card from available
                selectedCard = availableCards[Math.floor(Math.random() * availableCards.length)];
            } else {
                // If no available cards, get any card of that rarity
                const allRarityCards = ALL_CARDS.filter(card => card.rarity === selectedRarity);
                selectedCard = allRarityCards[Math.floor(Math.random() * allRarityCards.length)];
            }
            
            // Mark card as obtained
            selectedCard.obtained = true;
            return selectedCard;
        }

        // Helper function to get card by name
        function getCard(cardName) {
            return ALL_CARDS.find(card => card.name === cardName) || ALL_CARDS[0];
        }

        // Update UI with current game data
        function updateUI() {
            // Update stats
            document.getElementById('currentClass').textContent = 
                gameData.userType === 'adult' ? '–í–∑—Ä–æ—Å–ª—ã–π' : `${gameData.currentClass}${gameData.classLetter}`;
            document.getElementById('userTypeInfo').textContent = 
                gameData.userType === 'adult' ? '–≤–∑—Ä–æ—Å–ª—ã–π' : '—É—á–µ–Ω–∏–∫';
            document.getElementById('coinsCount').textContent = gameData.coins;
            
            // Update user greeting
            if (gameData.userType === 'student') {
                document.getElementById('userGreeting').textContent = 
                    `${gameData.currentClass}${gameData.classLetter} –∫–ª–∞—Å—Å, ${gameData.school}`;
                document.getElementById('fullClassInfo').textContent = 
                    `${gameData.currentClass}${gameData.classLetter} –∫–ª–∞—Å—Å, ${gameData.school}, ${gameData.city}`;
            } else {
                document.getElementById('userGreeting').textContent = '–°–æ–±–∏—Ä–∞–π –º–µ–º—ã, —Å—Ç–∞–Ω—å –ª–µ–≥–µ–Ω–¥–æ–π!';
                document.getElementById('fullClassInfo').textContent = '–†–µ–∂–∏–º –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö';
            }
            
            // Update collection progress
            const collected = ALL_CARDS.filter(card => card.obtained).length;
            const total = ALL_CARDS.length;
            const progress = total > 0 ? (collected / total) * 100 : 0;
            
            document.getElementById('collectedCards').textContent = collected;
            document.getElementById('totalCards').textContent = total;
            document.getElementById('collectionProgress').style.width = progress + '%';
            
            // Load inventory
            loadInventory();
            
            // Load collection
            loadCollection();
            
            // Load profile
            loadProfile();
        }

        // Load inventory (obtained cards)
        function loadInventory() {
            const container = document.getElementById('inventoryList');
            container.innerHTML = '';
            
            const obtainedCards = ALL_CARDS.filter(card => card.obtained);
            
            if (obtainedCards.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7);">üé¥ –ü–æ–∫–∞ –Ω–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫</div>';
                return;
            }
            
            obtainedCards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = `card ${card.rarity}`;
                
                cardElement.innerHTML = `
                    <h3>${card.name}</h3>
                    <div class="card-meta">
                        <span class="rarity-badge ${card.rarity}-badge">${getRarityName(card.rarity)}</span>
                        <span>‚úÖ –ü–æ–ª—É—á–µ–Ω–∞</span>
                    </div>
                `;
                
                container.appendChild(cardElement);
            });
        }

        // Load all collection
        function loadCollection() {
            const container = document.getElementById('collectionList');
            container.innerHTML = '';
            
            // Sort cards by rarity (new order: common -> rare -> epic -> legendary -> secret -> og -> god)
            const sortedCards = [...ALL_CARDS].sort((a, b) => {
                const rarityOrder = { 
                    common: 0, 
                    rare: 1, 
                    epic: 2, 
                    legendary: 3, 
                    secret: 4, 
                    og: 5, 
                    god: 6 
                };
                return rarityOrder[a.rarity] - rarityOrder[b.rarity];
            });
            
            sortedCards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = `card ${card.rarity}`;
                if (!card.obtained) {
                    cardElement.style.opacity = '0.6';
                }
                
                cardElement.innerHTML = `
                    <h3>${card.name}</h3>
                    <div class="card-meta">
                        <span class="rarity-badge ${card.rarity}-badge">${getRarityName(card.rarity)}</span>
                        <span>${card.obtained ? '‚úÖ –ü–æ–ª—É—á–µ–Ω–∞' : 'üîí –ù–µ –ø–æ–ª—É—á–µ–Ω–∞'}</span>
                    </div>
                `;
                
                container.appendChild(cardElement);
            });
        }

        // Load profile
        function loadProfile() {
            const container = document.getElementById('profileContent');
            const schoolContainer = document.getElementById('schoolInfo');
            const profile = gameData.profile;
            
            const totalQuestions = profile.total_quizzes * 5;
            const accuracy = totalQuestions > 0 ? (profile.correct_answers / totalQuestions) * 100 : 0;
            const collected = ALL_CARDS.filter(card => card.obtained).length;
            
            container.innerHTML = `
                <div class="profile-info">
                    <div><strong>${gameData.userType === 'student' ? 'üéí –£—á–µ–Ω–∏–∫' : 'üë®‚Äçüéì –í–∑—Ä–æ—Å–ª—ã–π'}</strong></div>
                    <div>‚≠ê XP: ${gameData.xp}</div>
                    <div>üí∞ –ú–æ–Ω–µ—Ç—ã: ${gameData.coins}</div>
                    <div>üé¥ –ö–∞—Ä—Ç: ${collected}/${ALL_CARDS.length}</div>
                    <div>üìä –ö–≤–∏–∑–æ–≤: ${profile.total_quizzes}</div>
                    <div>üéØ –¢–æ—á–Ω–æ—Å—Ç—å: ${accuracy.toFixed(1)}%</div>
                    <div>üèÜ –†–µ–π—Ç–∏–Ω–≥: ${profile.rating}</div>
                </div>
            `;
            
            if (gameData.userType === 'student') {
                schoolContainer.innerHTML = `
                    <div class="profile-info">
                        <div>üèôÔ∏è –ì–æ—Ä–æ–¥: ${gameData.city}</div>
                        <div>üè´ –®–∫–æ–ª–∞: ${gameData.school}</div>
                        <div>üéí –ö–ª–∞—Å—Å: ${gameData.currentClass}${gameData.classLetter}</div>
                        <div>üë• –û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–æ–≤ –≤ –≥—Ä—É–ø–ø–µ: <strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ!</strong></div>
                    </div>
                `;
            } else {
                schoolContainer.innerHTML = `
                    <div class="profile-info">
                        <div>üë®‚Äçüéì –†–µ–∂–∏–º –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö</div>
                        <div>üéì –°—Ç–∞—Ç—É—Å: –°—Ç—É–¥–µ–Ω—Ç/–í—ã–ø—É—Å–∫–Ω–∏–∫</div>
                    </div>
                `;
            }
        }

        // Rarity helpers
        function getRarityName(rarity) {
            const names = {
                "common": "–û–±—ã—á–Ω—ã–π",
                "rare": "–†–∞—Ä–Ω—ã–π", 
                "epic": "–≠–ø–∏–∫",
                "legendary": "–õ–µ–≥–µ–Ω–¥–∞",
                "secret": "–°–µ–∫—Ä–µ—Ç–Ω—ã–π",
                "og": "OG",
                "god": "üëë –ë–æ–≥ BrainRot"
            };
            return names[rarity] || "–û–±—ã—á–Ω—ã–π";
        }

        // Hide all screens
        function hideAllScreens() {
            const screens = [
                'registrationScreen', 'schoolFormScreen', 'mainScreen', 
                'quizSection', 'quizQuestionsSection', 'shopSection',
                'inventorySection', 'collectionSection', 'profileSection',
                'editSchoolForm', 'loadingScreen'
            ];
            
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
            
            // –í—Å–µ–≥–¥–∞ —Å–∫—Ä—ã–≤–∞–µ–º –ª—É—Ç–±–æ–∫—Å
            hideLootboxAnimation();
        }

        // Navigation functions
        function showSection(section) {
            hideAllScreens();
            document.getElementById(section + 'Section').classList.remove('hidden');
        }
        
        function showMain() {
            hideAllScreens();
            document.getElementById('mainScreen').classList.remove('hidden');
        }

        // Show quiz questions section
        function showQuizQuestions() {
            hideAllScreens();
            document.getElementById('quizQuestionsSection').classList.remove('hidden');
        }

        // Start quiz
        function startQuiz() {
            // Select 5 random questions
            const shuffledQuestions = [...GENERAL_KNOWLEDGE_QUESTIONS]
                .sort(() => 0.5 - Math.random())
                .slice(0, 5);
            
            currentQuiz = {
                questions: shuffledQuestions,
                currentQuestion: 0,
                correctAnswers: 0
            };
            
            showQuizQuestions();
            showQuizQuestion(0);
        }

        // Show quiz question
        function showQuizQuestion(questionIndex) {
            const question = currentQuiz.questions[questionIndex];
            
            document.getElementById('currentQuestionNumber').textContent = questionIndex + 1;
            document.getElementById('quizQuestion').textContent = question.q;
            
            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = '';
            
            question.opts.forEach((option, index) => {
                const optionElement = document.createElement('button');
                optionElement.className = 'quiz-option';
                optionElement.textContent = option;
                optionElement.onclick = () => checkAnswer(questionIndex, index);
                optionsContainer.appendChild(optionElement);
            });
        }

        // Check answer
        function checkAnswer(questionIndex, answerIndex) {
            const question = currentQuiz.questions[questionIndex];
            
            if (answerIndex === question.a) {
                currentQuiz.correctAnswers++;
                gameData.xp += 10;
            }
            
            // Next question or finish quiz
            if (questionIndex < currentQuiz.questions.length - 1) {
                currentQuiz.currentQuestion++;
                showQuizQuestion(currentQuiz.currentQuestion);
            } else {
                finishQuiz();
            }
        }

        // Finish quiz - REMOVED CARD REWARDS
        function finishQuiz() {
            const correct = currentQuiz.correctAnswers;
            const total = currentQuiz.questions.length;
            const coinsReward = correct * 20; // 20 coins per correct answer
            
            gameData.coins += coinsReward;
            gameData.profile.total_quizzes += 1;
            gameData.profile.correct_answers += correct;
            
            saveGameData();
            updateUI();
            showSection('quiz');
            
            alert(`üéâ –ö–≤–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!\n‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${correct}/${total}\nüí∞ –ù–∞–≥—Ä–∞–¥–∞: +${coinsReward} –º–æ–Ω–µ—Ç`);
        }

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>